<html><head><meta name="qrichtext" content="charset=utf-8" /></head><body style="font-size:10pt;font-family:Sans">
<p><span style="font-family:Fixed;font-size:9pt;font-weight:600;color:#aa0000">{{REM=   fournissez un fichier nommé tmp.pdf dans ImagesScanner ou changez le nom dans la macro                    }}\<br />{{REM=   sur un développement de Jocelyn Perruchet                                                                 }}\<br />{{\<br />{{REM=  ----------------- execution conditionnelle d'instructions -------------------------------------------------}}\<br />{{REM=  Le probleme est de faire en sorte que la macro ne s'execute qu'au moment de la creation du document        }}\<br />{{REM=  et non lors de la previsualisation                                                                         }}\<br />{{REM=  ASTUCE : on teste si la variable systeme : $SCRIPT_STATUS contient la valeur $FUSION_ADD ou $FUSION_CREATE }}\<br />{{REM=           ce qui est le cas lors de la creation effective de document.                                      }}\<br />{{REM=           et alors si vrai on positionne une variable pdf_ValidAction sur du vide sinon sur une valeur      }}\<br />{{REM=           quelconque M_NOP pour notre exemple.                                                              }}\<br />{{REM=           Le terme {{VAR = pdf_ValidAction}} etant place devant des instructions celles-ci seront prefixes  }}\<br />{{REM=           par le contenu de cette variable, soit M_NOP si on est en mode previsualisation                   }}\<br />{{REM=                                                  ou vide si on en mode creation effective du document       }}\<br />{{REM=           le fait d'avoir M_NOP comme prefixe rendra l'instruction non reconnaissable par le langage de     }}\<br />{{REM=           script et elle ne sera donc pas executee et donc invalidee.                                       }}\<br /><br />{{:: SET_VAR(retour_de_liste,Rejected)}}\<br />{{:: SET_VAR(pdf_ValidPopupNoFile,{{:: SI(S,{{FE=../../ImagesScanner/tmp.pdf}},=,,,M_NOP)}})}}\<br />{{:: SET_VAR(pdf_ValidAction,{{:: SI(S,{{VAR=$SCRIPT_STATUS}},%%,$FUSION_ADD, ,{{:: SI(S,{{VAR=$SCRIPT_STATUS}},%%,$FUSION_CREATE,,M_NOP)}})}})}}\<br />{{:: SET_VAR(pdf_ValidAction,{{:: SI(S,{{FE=../../ImagesScanner/tmp.pdf}},=,,M_NOP,{{VAR  = pdf_ValidAction}})}})}}\<br />{{:: SET_VAR(TypeDoc,   {{:: {{VAR  = pdf_ValidAction}}DO_LISTE(Hospitalisation|Consultation|Courrier| , Type de document ,|, retour_de_liste)}})}}\<br />{{:: SET_VAR(pdf_ValidAction,{{:: SI(S,{{VAR=retour_de_liste}},=,Rejected,M_NOP,{{VAR  = pdf_ValidAction}})}})}}\<br />{{:: SET_VAR(Discipline, {{:: {{VAR = pdf_ValidAction}}DO_LISTE(Cardiologie|Pneumologie|Gastro|Endocrino|Neurologie|Orthopédie|Rhumatologie Hématologie|Urgences|Chirurgie digestive| ,Spécialité ,|, retour_de_liste)}})}}\<br />{{:: SET_VAR(pdf_ValidAction,{{:: SI(S,{{VAR=retour_de_liste}},=,Rejected,M_NOP,{{VAR  = pdf_ValidAction}})}})}}\<br />{{:: SET_VAR(NomFichierDst, {{GET_DOSS_GUID}}_{{VAR = TypeDoc}}_{{VAR = Discipline}}_{{DATE = yyyyMMdd}}_{{HeureCourante = hhmmss}}.pdf)}}\<br /></span><span style="font-family:Fixed;font-size:9pt;font-weight:600">{{::#SET_VAR(pdf_MessageFinal,{{::#SI(S,{{FE=../../ImagesScanner/tmp.pdf}},=,,Pas de fichier numérisé disponible,</span><span style="font-family:Fixed;font-size:9pt;font-weight:600;text-decoration:underline;color:#0000ff">Voir ce fichier PDF</span><span style="font-family:Fixed;font-size:9pt;font-weight:600"> {{VAR = NomFichierDst}})}})}}\</span><span style="font-family:Fixed;font-size:9pt;font-weight:600;color:#aa0000"><br />{{:: {{VAR = pdf_ValidAction}}copy_file($ToAbsPath ../../ImagesScanner/tmp.pdf,$ToAbsPath ../../pdf/{{VAR = NomFichierDst}}, $remove_src_file)}}\<br />{{:: {{VAR = pdf_ValidAction}}Intitule ( {{VAR = TypeDoc}} {{VAR = Discipline}} ) }}\<br />}}\<br /></span><span style="font-family:Fixed;font-size:9pt;font-weight:600;color:#f0efe6">{{:: SI(S,{{VAR  = pdf_ValidAction}},=,M_NOP,__ERREUR Fusion :__,)}}</span><span style="font-family:Fixed;font-size:9pt;font-weight:600"><br />{{:: {{VAR  = pdf_ValidPopupNoFile}}MESSAGE_POPUP ({{VAR=pdf_MessageFinal}})}}<br /><br /></span><span style="font-family:Fixed;font-size:9pt;font-weight:600;color:#aa0000"><br /></span><hr><img src=pdfLies.png ><span style="font-family:Fixed;font-size:9pt;font-weight:600">{{VAR=pdf_MessageFinal}}</span><br /><br /><span style="font-family:Fixed;font-size:9pt;font-weight:600;color:#aa0000"><br /><br /></span></p>
</body></html>
